<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>VACANCY</title>
<link rel="stylesheet" href="../css/map.css">
<link rel="icon" href="path/to/favicon.ico" type="image/x-icon">
<script type="text/javascript"
		src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=78b33a405481aa556df21c1eda9ce3ee&libraries=services,clusterer,drawing"></script>
</head>
<body>
	<header>
		<div class="header"><img src="/images/logo.png" alt="Vacancy Logo" class="logo" id="logo"><h1>공실정보</h1>
		</div>
		<div id="searchBox">
			<input type="text" id="address" placeholder="주소를 입력하세요"><button id="searchBtn">검색</button>
			<input type="text" id="keyword" placeholder="장소를 입력하세요"><button id="searchPlaceBtn">검색</button>
		</div>
	</header>
	
<div id="map"></div>
<div id="clickLatlng"></div>
<button id="locateMeBtn">내위치</button>

<script>
   var map, marker, customOverlay, clusterer;
   
   function initializeMap(lat, lng) {
       map = new kakao.maps.Map(document.getElementById('map'), {
           center: new kakao.maps.LatLng(lat, lng),
           level: 3,
           mapTypeId: kakao.maps.MapTypeId.ROADMAP
       });
       map.addControl(new kakao.maps.MapTypeControl(), kakao.maps.ControlPosition.TOPRIGHT);
       map.addControl(new kakao.maps.ZoomControl(), kakao.maps.ControlPosition.RIGHT);
       marker = new kakao.maps.Marker({
           position: new kakao.maps.LatLng(lat, lng),
           map: map
       });
       
       kakao.maps.event.addListener(map, 'click', function(mouseEvent) {
           const latlng = mouseEvent.latLng;           
           if (marker) {
               marker.setMap(null);
           }
           marker = new kakao.maps.Marker({
               position: latlng,
               map: map
           });
       });
   }

   function getLocation(callback) {
       if (navigator.geolocation) {
           navigator.geolocation.getCurrentPosition(
               position => callback(position.coords.latitude, position.coords.longitude),
               error => {
                   const errorMsgs = {
                       [error.PERMISSION_DENIED]: '사용자가 위치 정보 요청을 거부했습니다.',
                       [error.POSITION_UNAVAILABLE]: '위치 정보를 사용할 수 없습니다.',
                       [error.TIMEOUT]: '위치 정보 요청이 시간 초과되었습니다.',
                       [error.UNKNOWN_ERROR]: '알 수 없는 오류가 발생했습니다.'
                   };
                   alert(errorMsgs[error.code] || '알 수 없는 오류가 발생했습니다.');
               }
           );
       } else {
           alert('현재 위치를 지원하지 않는 브라우저입니다.');
       }
   }
   
   document.addEventListener('DOMContentLoaded', function() {
       getLocation((lat, lng) => initializeMap(lat, lng));
       document.getElementById('logo').addEventListener('click', function() {
           window.location.href = '/index'; 
       });

       document.getElementById('locateMeBtn').addEventListener('click', function() {
           getLocation((lat, lng) => {
               map.setCenter(new kakao.maps.LatLng(lat, lng));
               if (marker) {
                   marker.setPosition(new kakao.maps.LatLng(lat, lng));
               } else {
                   marker = new kakao.maps.Marker({
                       position: new kakao.maps.LatLng(lat, lng),
                       map: map
                   });
               }
           });
       });
});
</script>
</body>
</html>