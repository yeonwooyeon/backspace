<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>VACANCY</title>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<!-- Custom CSS -->
<link rel="stylesheet" href="../css/map.css">
<link rel="icon" href="path/to/favicon.ico" type="image/x-icon">
<script type="text/javascript"
   src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=78b33a405481aa556df21c1eda9ce3ee&libraries=services,clusterer,drawing"></script>
</head>

<body>
   <header>
      <div class="header">
         <img src="/images/logo.png" alt="Vacancy Logo" class="logo" id="logo">
         <h1>공실정보</h1>
      </div>
      <div id="searchBox">
         <input type="text" id="address" placeholder="주소를 입력하세요">
         <button id="searchBtn">검색</button>
      </div>
   </header>
   <!-- Bootstrap JS and dependencies -->
   <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
   <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
   <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
   <!-- Custom JS -->
   <script src="js/map.js" defer></script>
   <div id="map"></div>
   <div id="clickLatlng"></div>   

   <script>
        var map, marker, customOverlay, clusterer;     

        kakao.maps.load(function() {
        	var markers = [];
        	 
            function initializeMap(lat, lng) {
                var locPosition = new kakao.maps.LatLng(lat, lng);

                var mapContainer = document.getElementById('map');
                var mapOptions = {
                    center: locPosition,
                    level: 3,
                    mapTypeId: kakao.maps.MapTypeId.ROADMAP
                };
                map = new kakao.maps.Map(mapContainer, mapOptions);

                var mapTypeControl = new kakao.maps.MapTypeControl();
                map.addControl(mapTypeControl, kakao.maps.ControlPosition.TOPRIGHT);
                var zoomControl = new kakao.maps.ZoomControl();
                map.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT);
                
                clusterer = new kakao.maps.MarkerClusterer({
                    map: map,
                    averageCenter: true,
                    minClusterSize: 2,
                    styles: [{
                        width: '40px',
                        height: '40px',
                        background: 'rgba(0, 0, 0, 0.8)',
                        borderRadius: '50%',
                        color: '#fff',
                        textAlign: 'center',
                        lineHeight: '40px',
                        fontSize: '12px',
                        fontWeight: 'bold' // Optional: makes the text bold
                    }]
                });
                
                var markerImageUrl = 'https://cdn-icons-png.flaticon.com/128/16138/16138394.png',
                    markerImageSize = new kakao.maps.Size(40, 42),
                    markerImageOptions = { offset: new kakao.maps.Point(20, 42) },
                    markerImage = new kakao.maps.MarkerImage(markerImageUrl, markerImageSize, markerImageOptions);

                function addMarker(lat, lng) {
                    var position = new kakao.maps.LatLng(lat, lng);
                    var marker = new kakao.maps.Marker({
                        position: position,
                        image: markerImage
                    });
                    markers.push(marker);
                    marker.setMap(map);
                }

                function updateCluster() {
                    clusterer.addMarkers(markers);
                }
                
                kakao.maps.event.addListener(map, 'click', function(mouseEvent) {
                    var latlng = mouseEvent.latLng;
                    marker.setPosition(latlng);

                    if (customOverlay) {
                        customOverlay.setMap(null);
                    }

               
                    var content = `
                        <div class="customoverlay">
                            <a href="https://map.kakao.com/link/map/${latlng.getLat()},${latlng.getLng()}" target="_blank">
                                <span class="title">위도: ${latlng.getLat().toFixed(5)}, 경도: ${latlng.getLng().toFixed(5)}</span>
                            </a>
                        </div>
                    `;
                    customOverlay = new kakao.maps.CustomOverlay({
                        position: latlng,
                        content: content,
                        yAnchor: 1
                    });
                    customOverlay.setMap(map);
                   
                    var resultDiv = document.getElementById('clickLatlng');
                    
                });
                
             // Add sample markers for demonstration
                // Replace with actual data for restaurants
                addMarker(37.5665, 126.978); // Example coordinates
                addMarker(37.5651, 126.989); // Example coordinates
                addMarker(37.5700, 126.975); // Example coordinates
                updateCluster();
            
            }

            function searchAddress() {
                var address = document.getElementById('address').value;
                if (!address) {
                    alert('도로명 주소를 입력해 주세요.');
                    return;
                }

                var geocoder = new kakao.maps.services.Geocoder();
                geocoder.addressSearch(address, function(results, status) {
                    if (status === kakao.maps.services.Status.OK) {
                        var result = results[0];
                        var lat = result.y;
                        var lng = result.x;
                        
                        

                        if (!map) {
                            initializeMap(lat, lng);
                        } else {
                            map.setCenter(new kakao.maps.LatLng(lat, lng));
                            marker.setPosition(new kakao.maps.LatLng(lat, lng));
                            if (customOverlay) {
                                customOverlay.setMap(null);
                            }                          
                         
                            var content = `
                                <div class="customoverlay">
                                    <a href="https://map.kakao.com/link/map/${lat},${lng}" target="_blank">
                                        <span class="title">위도: ${lat.toFixed(0)}, 경도: ${lng.toFixed(0)}</span>
                                    </a>
                                </div>
                            `;
                            customOverlay = new kakao.maps.CustomOverlay({
                                position: new kakao.maps.LatLng(lat, lng),
                                content: content,
                                yAnchor: 1
                            });
                            customOverlay.setMap(map);
                        }
                        
                        var resultDiv = document.getElementById('clickLatlng');
                       
                       } else {
                        alert('도로명 주소를 찾을 수 없습니다.');
                    }
                });
            }

            function getLocation() {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(function(position) {
                        var lat = position.coords.latitude;
                        var lng = position.coords.longitude;
                        initializeMap(lat, lng);
                    }, function(error) {
                        var errorMsg = '위치 정보를 가져오는 데 실패했습니다.';
                        switch (error.code) {
                            case error.PERMISSION_DENIED:
                                errorMsg = '사용자가 위치 정보 요청을 거부했습니다.';
                                break;
                            case error.POSITION_UNAVAILABLE:
                                errorMsg = '위치 정보를 사용할 수 없습니다.';
                                break;
                            case error.TIMEOUT:
                                errorMsg = '위치 정보 요청이 시간 초과되었습니다.';
                                break;
                            case error.UNKNOWN_ERROR:
                                errorMsg = '알 수 없는 오류가 발생했습니다.';
                                break;
                        }
                        alert(errorMsg);
                    });
                } else {
                    alert('현재 위치를 지원하지 않는 브라우저입니다.');
                }
            }

            getLocation();
            document.getElementById('searchBtn').addEventListener('click', function() {
                searchAddress();
            });
            document.getElementById('address').addEventListener('keypress', function(event) {
                if (event.key === 'Enter') {
                    searchAddress();
                }
            });
        });
        
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('logo').addEventListener('click', function() {
                window.location.href = '/index'; // 로고 클릭 시 /index로 이동
            });
        });
      
</script>
</body>
</html>

